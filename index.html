<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Multiplayer Chat com Salas e Dados RPG</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#111; color:#fff; }
    #chat { position:fixed; bottom:10px; left:10px; width:320px; background:rgba(0,0,0,0.7); color:white; padding:10px; border-radius:8px; z-index:1000; }
    #messages { list-style: none; padding: 0; max-height:150px; overflow-y:auto; font-family: monospace; font-size:14px; }
    #messages li { padding: 3px; margin-bottom: 3px; border-bottom: 1px solid #444; }
    #form { display: flex; margin-top: 5px; }
    #input { flex: 1; padding: 6px; background:#222; color:white; border:1px solid #555; border-radius:4px; }
    #send { padding: 6px; background:#0084ff; color:white; border:none; border-radius:4px; cursor:pointer; }
    /* Modal */
    #modalOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center;
      z-index:2000;
    }
    #modalBox {
      background:#fff; color:#000; padding:20px; border-radius:8px; text-align:center; min-width:250px;
    }
    #modalBox input { width:90%; padding:6px; margin-top:10px; border:1px solid #ccc; border-radius:4px; }
    #modalBox button { margin-top:10px; padding:6px 12px; background:#0084ff; color:#fff; border:none; border-radius:4px; cursor:pointer; }
  </style>
</head>
<body>
  <div id="chat">
    <h3>Chat Multiplayer</h3>
    <ul id="messages"></ul>
    <form id="form">
      <input id="input" autocomplete="off" placeholder="Digite sua mensagem..." />
      <button id="send">Enviar</button>
    </form>
  </div>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <script>
    const socket = io("https://multiplayer-serve-edson-simplicio.onrender.com");

    let username = null;
    let currentRoom = null;

    // === Modal para nome, sala e senha ===
    function pedirNomeESala() {
      const overlay = document.createElement("div");
      overlay.id = "modalOverlay";

      const box = document.createElement("div");
      box.id = "modalBox";

      const titulo = document.createElement("h3");
      titulo.innerText = "Escolha seu nome e sala:";
      box.appendChild(titulo);

      const nomeInput = document.createElement("input");
      nomeInput.placeholder = "Seu nome";
      box.appendChild(nomeInput);

      const salaInput = document.createElement("input");
      salaInput.placeholder = "Nome da sala";
      box.appendChild(salaInput);

      const senhaInput = document.createElement("input");
      senhaInput.placeholder = "Senha da sala";
      senhaInput.type = "password";
      box.appendChild(senhaInput);

      const entrarBtn = document.createElement("button");
      entrarBtn.innerText = "Entrar na sala";
      entrarBtn.onclick = () => {
        const nome = nomeInput.value.trim();
        const sala = salaInput.value.trim();
        const senha = senhaInput.value.trim();
        if (nome && sala && senha) {
          username = nome;
          currentRoom = sala;
          socket.emit("joinRoom", { room: sala, password: senha, user: nome });
          document.body.removeChild(overlay);
        }
      };
      box.appendChild(entrarBtn);

      const criarBtn = document.createElement("button");
      criarBtn.innerText = "Criar sala";
      criarBtn.onclick = () => {
        const nome = nomeInput.value.trim();
        const sala = salaInput.value.trim();
        const senha = senhaInput.value.trim();
        if (nome && sala && senha) {
          username = nome;
          currentRoom = sala;
          socket.emit("createRoom", { room: sala, password: senha, user: nome });
          document.body.removeChild(overlay);
        }
      };
      box.appendChild(criarBtn);

      overlay.appendChild(box);
      document.body.appendChild(overlay);
    }

    window.onload = pedirNomeESala;

    const form = document.getElementById("form");
    const input = document.getElementById("input");
    const messages = document.getElementById("messages");

    // Envia mensagem para o servidor
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if (input.value && username && currentRoom) {
        socket.emit("chatMessage", { room: currentRoom, user: username, text: input.value });
        input.value = "";
      }
    });

    // Recebe mensagens do servidor
    socket.on("chatMessage", (msg) => {
      const li = document.createElement("li");
      li.textContent = msg.user + ": " + msg.text;
      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    });

    // Feedback de sala
    socket.on("joinSuccess", (msg) => {
      const li = document.createElement("li");
      li.textContent = "✅ " + msg;
      messages.appendChild(li);
    });

    socket.on("joinError", (msg) => {
      const li = document.createElement("li");
      li.textContent = "❌ " + msg;
      messages.appendChild(li);
    });
  </script>
</body>
</html>
